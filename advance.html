<!DOCTYPE html>
<html>
<head>
  <title>Manage Advance</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css" />
  <style>
    .card { max-width: 800px; margin: auto; padding: 20px; background: white; color: black; border-radius: 10px; }
    input, select, textarea { width: 100%; padding: 10px; margin: 5px 0; border-radius: 8px; border: 1px solid #ccc; }
    button { padding: 10px 20px; border: none; background: green; color: white; border-radius: 8px; cursor: pointer; }
    button:hover { background: darkgreen; }
    @media(max-width: 600px) {
      .card { padding: 10px; }
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>
  <div class="card">
    <h2>ðŸ’¸ Worker Advance Management</h2>

    <select id="workerSelect">
      <option value="">Select Worker</option>
    </select>

    <input type="number" id="advanceAmount" placeholder="Advance Amount â‚¹" />
    <input type="number" id="weeklyCut" placeholder="Weekly Cut â‚¹" />
    <textarea id="reason" placeholder="Reason for Advance"></textarea>

    <button onclick="submitAdvance()">Submit Advance</button>

    <p id="msg"></p>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC3aue5Fg1Rpqk3rzkjQiQTBe76U6RA7GM",
      authDomain: "worker-management-50d6d.firebaseapp.com",
      projectId: "worker-management-50d6d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const msg = document.getElementById("msg");

    function loadWorkers() {
      db.collection("workers").orderBy("name").get().then(snapshot => {
        const select = document.getElementById("workerSelect");
        snapshot.forEach(doc => {
          const option = document.createElement("option");
          option.value = doc.id;
          option.textContent = doc.data().name;
          select.appendChild(option);
        });
      });
    }

    function submitAdvance() {
      const workerId = document.getElementById("workerSelect").value;
      const advanceAmount = parseFloat(document.getElementById("advanceAmount").value);
      const weeklyCut = parseFloat(document.getElementById("weeklyCut").value);
      const reason = document.getElementById("reason").value;

      if (!workerId || !advanceAmount || !weeklyCut || !reason) {
        msg.style.color = "red";
        msg.innerText = "âš ï¸ Please fill all fields.";
        return;
      }

      const workerName = document.getElementById("workerSelect").selectedOptions[0].text;

      const record = {
        workerId,
        workerName,
        advanceAmount,
        weeklyCut,
        remainingBalance: advanceAmount,
        reason,
        cutHistory: [],
        status: "Active",
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };

      db.collection("advances").add(record)
        .then(() => {
          msg.style.color = "green";
          msg.innerText = "âœ… Advance added!";
          document.getElementById("advanceAmount").value = "";
          document.getElementById("weeklyCut").value = "";
          document.getElementById("reason").value = "";
        })
        .catch(err => {
          msg.style.color = "red";
          msg.innerText = "Error: " + err.message;
        });
    }

    loadWorkers();
  </script>
</body>
</html>
